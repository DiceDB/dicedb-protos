syntax = "proto3";

package wire;
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
option go_package = "./wire";

message ValueList {
    repeated google.protobuf.Value v_list = 1;
}

message StringStringMap {
    map<string, string> v_ss_map = 1;
}

message Attributes {
    google.protobuf.Struct attrs = 1;
}

message StringSlice {
    repeated string v_list = 1;
}

enum ObjectType {
    DATA_TYPE_UNSPECIFIED = 0;
    STRING = 1;
    JSON = 2;
    BYTES = 3;
    INT = 4;
    SET = 5;
    STRING_STRING_MAP = 6;
    SORTED_SET = 7;
    COUNT_MIN_SKETCH = 8;
    BLOOM_FILTER = 9;
    DEQUEUE = 10;
    HYPER_LOG_LOG = 11;
    FLOAT = 12;
}

enum ExpireStatus {
    NOT_FOUND = 0;
    EXPIRED = 1;
    NOT_EXPIRED = 2;
}

// Command responses
message Command {
    string cmd = 1;
    repeated string args = 2;
}

message Message {
    oneof result {
        bool v_nil = 1;
        string v_str = 2;
    }
}

message MessageWatch {
    Message result = 1;
    Attributes v_attrs = 2;
}

message ValueWatch {
    Value result = 1;
    Attributes v_attrs = 2;
}

message Value {
    oneof result {
        bool v_nil = 1;
        int64 v_int = 2;
        string v_str = 3;
        bytes v_bytes = 4;
    }
}

message FieldValueMap {
    oneof result {
        bool v_nil = 1;
        StringStringMap v_ss_map = 2;
    }
}

message FieldValueMapWatch {
    FieldValueMap result = 1;
    Attributes v_attrs = 2;
}

message HSETResponse {
    oneof result {
        bool v_nil = 1;
        int64 v_int = 2;
    }
}

message Counter {
    oneof result {
        bool v_nil = 1;
        int64 counter = 2;
    }
}

message KEYSResponse {
    oneof result {
        bool v_nil = 1;
        StringSlice matching_keys = 2;
    }
}

message ExpiryDetails {
    oneof result {
        ExpireStatus status = 1;
        google.protobuf.Timestamp expiry_time = 2;
    }
}

message TYPEResponse {
    oneof result {
        bool status = 1;
        ObjectType object_type = 2;
    }
}

message ZADDResponse {
    oneof result {
        bool v_nil = 1;
        int64 v_int = 2;
        string v_str = 3;
    }
}

message ZPOPResponse {
    oneof result {
        bool has_key = 1;
        SortedSetMemberSlice popped_members = 2;
    }
}

message SortedSetMemberSlice {
    repeated SortedSetMember slice = 1;
}

message SortedSetMember {
    string member_name = 1;
    string score = 2;
}

message Element {
    oneof element {
        string v_str = 1;
        bytes v_bytes = 2;
    }
    oneof score {
        int64 v_int = 3;
        double v_float = 4;
    }
}

message ZRANKResponse {
    oneof result {
        bool value_exists = 1;
        int64 rank = 2;
    }
    optional double score = 3;
}

message Response {
    oneof command_response {
        Counter decr = 1;
        Counter decr_by = 2;
        Counter del = 3;
        Message echo = 4;
        Counter exists = 5;
        bool expire = 6;
        bool expire_at = 7;
        bool flushdb = 8;
        ValueWatch get_watch = 9;
        Value get = 10;
        Value get_del = 11;
        Value get_ex = 12;
        Value get_set = 13;
        bool handshake = 14;
        Message hget = 15;
        MessageWatch hget_watch = 16;
        FieldValueMap hget_all = 17;
        FieldValueMapWatch hget_all_watch = 18;
        Counter hset = 19;
        Counter incr = 20;
        Counter incr_by = 21;
        StringSlice keys = 22;
        Message ping = 23;
        Value set = 24;
        ExpiryDetails ttl = 25;
        TYPEResponse type = 26;
        bool unwatch = 27;
        ZADDResponse zadd = 28; // verify
        ZPOPResponse zpopmax = 29;
        ZPOPResponse zpopmin = 30;
        ZRANKResponse zrank = 31;
    }
}